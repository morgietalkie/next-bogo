"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var with_referring_documents_1 = require("part:@sanity/base/with-referring-documents");
var react_1 = __importStar(require("react"));
var io_1 = require("react-icons/io");
var Box_1 = __importDefault(require("../../styled/Box"));
var Image_1 = __importDefault(require("../../styled/Image"));
var imageDprUrl_1 = __importDefault(require("../../util/imageDprUrl"));
var Button_1 = __importDefault(require("../Button/Button"));
var ResponsiveBox_1 = __importDefault(require("../ResponsiveBox/ResponsiveBox"));
var useClickOutside_1 = __importDefault(require("../../hooks/useClickOutside"));
var Dialog = function (props) {
    var _a, _b, _c;
    var actions = props.actions, asset = props.asset, children = props.children, onClose = props.onClose, title = props.title, _d = props.variant, variant = _d === void 0 ? 'default' : _d;
    var imageUrl = imageDprUrl_1.default(asset, 250);
    var isDanger = variant === 'danger';
    var refContainer = react_1.useRef(null);
    // Close when clicked outside dialog container
    useClickOutside_1.default(refContainer, function () {
        onClose();
    });
    return (react_1.default.createElement(Box_1.default, { display: "flex", flexDirection: "column", maxHeight: "calc(100% - 100px)", maxWidth: "560px", overflow: "hidden", ref: refContainer, width: "100%" },
        react_1.default.createElement(Box_1.default, { alignItems: "center", bg: "darkestGray", fontSize: 1, display: "flex", height: "headerRowHeight", justifyContent: "space-between", pl: 3, textColor: "lighterGray" },
            react_1.default.createElement(Box_1.default, { alignItems: "center", display: "flex", textColor: isDanger ? 'red' : 'inherit' },
                isDanger && (react_1.default.createElement(Box_1.default, { mr: 1 },
                    react_1.default.createElement(io_1.IoIosAlert, { size: 18, style: { display: 'block' } }))),
                react_1.default.createElement("strong", null, title)),
            react_1.default.createElement(Button_1.default, { icon: io_1.IoIosClose({ size: 25 }), onClick: onClose })),
        react_1.default.createElement(Box_1.default
        // alignItems="center"
        , { 
            // alignItems="center"
            bg: "darkestGray", className: "custom-scrollbar", display: "grid", 
            // gridGap="1rem"
            gridTemplateColumns: ['none', 'max-content 1fr'], justifyItems: ['center', 'flex-start'], overflowY: "auto", textColor: "lightGray" },
            react_1.default.createElement(Box_1.default, { width: "200px" },
                react_1.default.createElement(ResponsiveBox_1.default, { aspectRatio: (_b = (_a = asset === null || asset === void 0 ? void 0 : asset.metadata) === null || _a === void 0 ? void 0 : _a.dimensions) === null || _b === void 0 ? void 0 : _b.aspectRatio },
                    react_1.default.createElement(Image_1.default, { draggable: false, showCheckerboard: !((_c = asset === null || asset === void 0 ? void 0 : asset.metadata) === null || _c === void 0 ? void 0 : _c.isOpaque), src: imageUrl }))),
            react_1.default.createElement(Box_1.default, { fontSize: 1, overflow: "hidden", position: "relative", px: 3, py: [3, 2], width: "100%" },
                react_1.default.createElement(with_referring_documents_1.WithReferringDocuments, { id: asset._id }, function (_a) {
                    var isLoading = _a.isLoading, referringDocuments = _a.referringDocuments;
                    var drafts = referringDocuments.reduce(function (acc, doc) {
                        return doc._id.startsWith('drafts.') ? acc.concat(doc._id.slice(7)) : acc;
                    }, []);
                    var filteredDocuments = referringDocuments.filter(function (doc) { return !drafts.includes(doc._id); });
                    if (isLoading) {
                        return react_1.default.createElement(Box_1.default, null, "Loading...");
                    }
                    if (filteredDocuments.length === 0) {
                        return react_1.default.createElement(Box_1.default, null, "No documents are referencing this asset");
                    }
                    return react_1.default.createElement("div", null, children(filteredDocuments));
                }))),
        react_1.default.createElement(Box_1.default, { alignItems: "center", bg: "darkestGray", display: "flex", height: "headerRowHeight", justifyContent: "space-between" }, actions.map(function (action, index) {
            return (react_1.default.createElement(Button_1.default, { icon: action === null || action === void 0 ? void 0 : action.icon, key: index, onClick: action === null || action === void 0 ? void 0 : action.callback, variant: action.variant }, action.title));
        }))));
};
exports.default = Dialog;
